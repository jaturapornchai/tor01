# ระบบสหกรณ์ออมทรัพย์ - System Architecture & Data Flow

## ภาพรวมระบบทั้งหมด (Complete System Overview)

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              COOP SYSTEM ARCHITECTURE                               │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                           AUTHENTICATION LAYER                               │  │
│  │                                                                              │  │
│  │                        ┌─────────────────────┐                               │  │
│  │                        │    GOOGLE LOGIN     │                               │  │
│  │                        │   (OAuth 2.0)       │                               │  │
│  │                        └──────────┬──────────┘                               │  │
│  │                                   │                                          │  │
│  │           ┌───────────────────────┼───────────────────────┐                  │  │
│  │           │                       │                       │                  │  │
│  │           ▼                       ▼                       ▼                  │  │
│  │   ┌──────────────┐        ┌──────────────┐        ┌──────────────┐          │  │
│  │   │  ADMIN WEB   │        │STAFF MOBILE  │        │MEMBER MOBILE │          │  │
│  │   │  (Next.js)   │        │   (App)      │        │    (App)     │          │  │
│  │   │  Full System │        │  Approval &  │        │  Self-Service│          │  │
│  │   └──────────────┘        │  Operations  │        │  Portal      │          │  │
│  │                           └──────────────┘        └──────────────┘          │  │
│  │                                                                              │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                        │                                           │
│                                        ▼                                           │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                              API LAYER (Next.js)                             │  │
│  │                           REST API / Server Actions                          │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                        │                                           │
│                                        ▼                                           │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                              DATABASE (MongoDB)                              │  │
│  │     Members │ Shares │ Deposits │ Loans │ Guarantors │ Welfare │ Users      │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 1. ระบบ Authentication (Google Login)

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                            GOOGLE AUTHENTICATION FLOW                               │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│                              ┌─────────────────┐                                   │
│                              │  Google OAuth   │                                   │
│                              │    Provider     │                                   │
│                              └────────┬────────┘                                   │
│                                       │                                            │
│                                       ▼                                            │
│                              ┌─────────────────┐                                   │
│                              │   NextAuth.js   │                                   │
│                              │  (Auth Handler) │                                   │
│                              └────────┬────────┘                                   │
│                                       │                                            │
│           ┌───────────────────────────┼───────────────────────────┐               │
│           │                           │                           │               │
│           ▼                           ▼                           ▼               │
│   ┌───────────────┐          ┌───────────────┐          ┌───────────────┐        │
│   │  Admin/Staff  │          │    Staff      │          │    Member     │        │
│   │   (Web)       │          │   (Mobile)    │          │   (Mobile)    │        │
│   ├───────────────┤          ├───────────────┤          ├───────────────┤        │
│   │ Role: admin   │          │ Role: staff   │          │ Role: member  │        │
│   │       staff   │          │       officer │          │               │        │
│   │       manager │          │       manager │          │               │        │
│   └───────────────┘          └───────────────┘          └───────────────┘        │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### User Collection Schema

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                 USERS COLLECTION                                    │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  {                                                                                  │
│    "_id": ObjectId,                                                                │
│    "googleId": "google-oauth-id",                                                  │
│    "email": "user@example.com",                                                    │
│    "name": "ชื่อผู้ใช้",                                                            │
│    "avatar": "https://...",                                                        │
│    "role": "admin | staff | officer | manager | member",                           │
│    "memberId": ObjectId (ถ้าเป็นสมาชิก),                                            │
│    "staffId": ObjectId (ถ้าเป็นพนักงาน),                                            │
│    "permissions": ["approve_loan", "approve_welfare", ...],                        │
│    "isActive": true,                                                               │
│    "lastLogin": Date,                                                              │
│    "createdAt": Date                                                               │
│  }                                                                                 │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. แพลตฟอร์มทั้ง 3 ระบบ

### 2.1 Admin Web (Next.js) - ระบบเต็มรูปแบบ

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                         ADMIN WEB SYSTEM (Next.js)                                  │
│                        Full-Featured Back Office                                    │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                              MODULES                                        │   │
│  ├─────────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                             │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │   │
│  │  │   สมาชิก      │  │    หุ้น       │  │   เงินฝาก    │  │   เงินกู้     │    │   │
│  │  │  Members     │  │   Shares     │  │  Deposits    │  │   Loans      │    │   │
│  │  ├──────────────┤  ├──────────────┤  ├──────────────┤  ├──────────────┤    │   │
│  │  │ • รายชื่อ     │  │ • ธุรกรรม    │  │ • เปิดบัญชี  │  │ • คำขอกู้    │    │   │
│  │  │ • สมัครใหม่   │  │ • ซื้อ/ถอน   │  │ • ฝาก/ถอน   │  │ • อนุมัติ    │    │   │
│  │  │ • แก้ไข      │  │ • โอน       │  │ • ดอกเบี้ย   │  │ • เบิกจ่าย   │    │   │
│  │  │ • อนุมัติ    │  │ • ปันผล     │  │ • ปิดบัญชี   │  │ • รับชำระ    │    │   │
│  │  │ • ลาออก     │  │ • รายงาน    │  │ • รายงาน    │  │ • ติดตามหนี้  │    │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘    │   │
│  │                                                                             │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │   │
│  │  │  ผู้ค้ำประกัน  │  │  สวัสดิการ   │  │   รายงาน    │  │   ตั้งค่า     │    │   │
│  │  │ Guarantors   │  │  Welfare     │  │  Reports     │  │  Settings    │    │   │
│  │  ├──────────────┤  ├──────────────┤  ├──────────────┤  ├──────────────┤    │   │
│  │  │ • ทะเบียนค้ำ  │  │ • ประเภท    │  │ • สรุปประจำวัน│  │ • ผู้ใช้งาน  │    │   │
│  │  │ • วงเงินค้ำ   │  │ • คำขอเบิก  │  │ • สรุปเดือน  │  │ • สิทธิ์     │    │   │
│  │  │ • ประวัติ    │  │ • อนุมัติ    │  │ • งบการเงิน │  │ • อัตราดอกเบี้ย│    │   │
│  │  │ • รับผิดชอบ  │  │ • จ่ายเงิน   │  │ • สถิติ     │  │ • ผลิตภัณฑ์  │    │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘    │   │
│  │                                                                             │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                            USER ROLES                                       │   │
│  ├─────────────────────────────────────────────────────────────────────────────┤   │
│  │ • Admin     : ทุกสิทธิ์ + จัดการผู้ใช้ + ตั้งค่าระบบ                          │   │
│  │ • Manager   : อนุมัติทุกอย่าง + รายงาน + ดูข้อมูลทั้งหมด                       │   │
│  │ • Officer   : ทำรายการ + ส่งขออนุมัติ                                        │   │
│  │ • Staff     : ดูข้อมูล + ทำรายการพื้นฐาน                                      │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 Staff Mobile App - แอปพนักงานสหกรณ์

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           STAFF MOBILE APPLICATION                                  │
│                     สำหรับพนักงานสหกรณ์ (Approval & Operations)                       │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                           MAIN FEATURES                                     │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
│   ┌──────────────────────┐                      ┌──────────────────────┐           │
│   │    📋 งานรออนุมัติ     │                      │    ✅ อนุมัติ/ปฏิเสธ   │           │
│   │   Pending Approvals  │                      │   Quick Actions      │           │
│   ├──────────────────────┤                      ├──────────────────────┤           │
│   │ • คำขอกู้ใหม่         │  ─────────────────▶ │ • อนุมัติ             │           │
│   │ • คำขอสวัสดิการ       │                      │ • ปฏิเสธ + เหตุผล    │           │
│   │ • สมัครสมาชิกใหม่     │                      │ • ส่งกลับแก้ไข       │           │
│   │ • ถอนหุ้น            │                      │ • ส่งต่อผู้มีอำนาจ    │           │
│   └──────────────────────┘                      └──────────────────────┘           │
│                                                                                     │
│   ┌──────────────────────┐                      ┌──────────────────────┐           │
│   │    💰 ทำรายการ        │                      │    📊 Dashboard      │           │
│   │   Transactions       │                      │   สรุปข้อมูล          │           │
│   ├──────────────────────┤                      ├──────────────────────┤           │
│   │ • รับชำระค่างวด       │                      │ • งานรอดำเนินการ     │           │
│   │ • รับฝากเงิน         │                      │ • สถิติวันนี้         │           │
│   │ • จ่ายเงินถอน        │                      │ • แจ้งเตือน          │           │
│   │ • สแกน QR           │                      │ • ปฏิทินนัดหมาย      │           │
│   └──────────────────────┘                      └──────────────────────┘           │
│                                                                                     │
│   ┌──────────────────────┐                      ┌──────────────────────┐           │
│   │    🔍 ค้นหาสมาชิก     │                      │    🔔 แจ้งเตือน       │           │
│   │   Member Search      │                      │   Notifications      │           │
│   ├──────────────────────┤                      ├──────────────────────┤           │
│   │ • ค้นหาด้วยชื่อ       │                      │ • งานใหม่รออนุมัติ    │           │
│   │ • สแกนบัตร          │                      │ • เงินกู้ค้างชำระ     │           │
│   │ • ดูประวัติ          │                      │ • สมาชิกครบกำหนด    │           │
│   │ • ดูยอดคงเหลือ       │                      │ • ประชุมคณะกรรมการ  │           │
│   └──────────────────────┘                      └──────────────────────┘           │
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                         STAFF ROLES                                         │  │
│   ├─────────────────────────────────────────────────────────────────────────────┤  │
│   │ • Manager  : อนุมัติได้ทุกรายการ + ดูรายงาน                                   │  │
│   │ • Officer  : อนุมัติตามวงเงิน + ทำรายการ                                      │  │
│   │ • Staff    : ทำรายการ + ส่งขออนุมัติ                                         │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.3 Member Mobile App - แอปสมาชิกสหกรณ์

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          MEMBER MOBILE APPLICATION                                  │
│                     สำหรับสมาชิกสหกรณ์ (Self-Service Portal)                         │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                           MAIN FEATURES                                     │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
│   ┌──────────────────────┐                      ┌──────────────────────┐           │
│   │    🏠 หน้าหลัก        │                      │    📝 สมัครสมาชิก     │           │
│   │   Home Dashboard     │                      │   Registration       │           │
│   ├──────────────────────┤                      ├──────────────────────┤           │
│   │ • ยอดหุ้น            │                      │ • กรอกข้อมูลส่วนตัว   │           │
│   │ • ยอดเงินฝาก        │                      │ • สแกนบัตรประชาชน   │           │
│   │ • ยอดเงินกู้คงเหลือ   │                      │ • ถ่ายรูปตนเอง       │           │
│   │ • ภาระค้ำประกัน      │                      │ • เลือก GPS ที่อยู่   │           │
│   │ • งวดถัดไป          │                      │ • ส่งเอกสาร         │           │
│   └──────────────────────┘                      └──────────────────────┘           │
│                                                                                     │
│   ┌──────────────────────┐                      ┌──────────────────────┐           │
│   │    📈 หุ้น           │                      │    💵 เงินฝาก        │           │
│   │   Shares             │                      │   Deposits           │           │
│   ├──────────────────────┤                      ├──────────────────────┤           │
│   │ • ดูยอดหุ้น          │                      │ • ดูยอดเงินฝาก       │           │
│   │ • ซื้อหุ้นเพิ่ม       │                      │ • ดูรายการ          │           │
│   │ • ขอถอนหุ้น         │                      │ • ดูดอกเบี้ย         │           │
│   │ • ประวัติหุ้น        │                      │ • ฝากประจำ          │           │
│   │ • ปันผลประจำปี      │                      │ • ประวัติฝากถอน     │           │
│   └──────────────────────┘                      └──────────────────────┘           │
│                                                                                     │
│   ┌──────────────────────┐                      ┌──────────────────────┐           │
│   │    🏦 เงินกู้         │                      │    🎁 สวัสดิการ       │           │
│   │   Loans              │                      │   Welfare            │           │
│   ├──────────────────────┤                      ├──────────────────────┤           │
│   │ • ยื่นคำขอกู้         │                      │ • ดูสิทธิ์สวัสดิการ   │           │
│   │ • คำนวณวงเงิน       │                      │ • ขอเบิกสวัสดิการ    │           │
│   │ • ตรวจสอบสถานะ      │                      │ • ติดตามคำขอ        │           │
│   │ • ดูตารางผ่อน        │                      │ • ประวัติการใช้       │           │
│   │ • ประวัติการกู้       │                      │ • ทุนการศึกษา        │           │
│   └──────────────────────┘                      └──────────────────────┘           │
│                                                                                     │
│   ┌──────────────────────┐                      ┌──────────────────────┐           │
│   │    🤝 ค้ำประกัน       │                      │    👤 โปรไฟล์        │           │
│   │   Guarantees         │                      │   Profile            │           │
│   ├──────────────────────┤                      ├──────────────────────┤           │
│   │ • วงเงินค้ำคงเหลือ    │                      │ • ข้อมูลส่วนตัว      │           │
│   │ • รายการที่ค้ำอยู่     │                      │ • แก้ไขที่อยู่        │           │
│   │ • คำขอค้ำใหม่        │                      │ • เปลี่ยนเบอร์โทร    │           │
│   │ • ยอมรับ/ปฏิเสธค้ำ   │                      │ • ผู้รับผลประโยชน์   │           │
│   │ • ประวัติค้ำประกัน   │                      │ • เอกสาร           │           │
│   └──────────────────────┘                      └──────────────────────┘           │
│                                                                                     │
│   ┌──────────────────────┐                      ┌──────────────────────┐           │
│   │    🔔 แจ้งเตือน       │                      │    📞 ติดต่อ          │           │
│   │   Notifications      │                      │   Contact            │           │
│   ├──────────────────────┤                      ├──────────────────────┤           │
│   │ • งวดชำระใกล้ถึง     │                      │ • โทรหาสหกรณ์       │           │
│   │ • สถานะคำขอ        │                      │ • แผนที่สหกรณ์      │           │
│   │ • ข่าวสารสหกรณ์     │                      │ • แชท/ส่งข้อความ    │           │
│   │ • ปันผลประจำปี      │                      │ • FAQ              │           │
│   └──────────────────────┘                      └──────────────────────┘           │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Data Flow ระหว่างแพลตฟอร์ม

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          CROSS-PLATFORM DATA FLOW                                   │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   MEMBER APP                     API SERVER                      STAFF APP         │
│   ┌─────────┐                   ┌─────────┐                    ┌─────────┐        │
│   │ สมาชิก   │                   │ Next.js │                    │ พนักงาน  │        │
│   └────┬────┘                   └────┬────┘                    └────┬────┘        │
│        │                             │                              │              │
│        │  ① ยื่นคำขอกู้               │                              │              │
│        │ ──────────────────────────▶│                              │              │
│        │                             │                              │              │
│        │                             │  ② แจ้งเตือนคำขอใหม่          │              │
│        │                             │ ────────────────────────────▶│              │
│        │                             │                              │              │
│        │                             │  ③ ดึงข้อมูลคำขอ              │              │
│        │                             │ ◀────────────────────────────│              │
│        │                             │                              │              │
│        │                             │  ④ ส่งผลอนุมัติ               │              │
│        │                             │ ◀────────────────────────────│              │
│        │                             │                              │              │
│        │  ⑤ แจ้งผลการอนุมัติ          │                              │              │
│        │ ◀──────────────────────────│                              │              │
│        │                             │                              │              │
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                                 WEB ADMIN                                   │  │
│   │                    ดูข้อมูลทั้งหมด + ทำรายการ + ออกรายงาน                       │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Workflow การยื่นกู้เงิน (Cross-Platform)

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          LOAN APPLICATION WORKFLOW                                  │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   MEMBER APP                                            STAFF APP / WEB            │
│                                                                                     │
│   ┌─────────────┐                                                                  │
│   │ ① ยื่นคำขอกู้ │                                                                  │
│   │ • เลือกประเภท│                                                                  │
│   │ • ระบุจำนวน  │                                                                  │
│   │ • เลือกผู้ค้ำ │                                                                  │
│   │ • แนบเอกสาร │                                                                  │
│   └──────┬──────┘                                                                  │
│          │                                                                          │
│          ▼                                                                          │
│   ┌─────────────┐           Push Notification          ┌─────────────┐            │
│   │  [pending]  │ ─────────────────────────────────▶  │ ② รับแจ้งเตือน │            │
│   │  รอพิจารณา  │                                      │  งานใหม่     │            │
│   └──────┬──────┘                                      └──────┬──────┘            │
│          │                                                     │                   │
│          │                                                     ▼                   │
│          │                                             ┌─────────────┐            │
│          │                                             │ ③ ตรวจสอบ   │            │
│          │                                             │ • ข้อมูลสมาชิก│            │
│          │                                             │ • วงเงินกู้ได้│            │
│          │                                             │ • ผู้ค้ำประกัน│            │
│          │                                             └──────┬──────┘            │
│          │                                                     │                   │
│          │              ┌──────────────────────────────────────┤                   │
│          │              │                                      │                   │
│          │              ▼                                      ▼                   │
│          │      ┌─────────────┐                        ┌─────────────┐            │
│          │      │ ④A อนุมัติ   │                        │ ④B ไม่อนุมัติ │            │
│          │      │ Level 1     │                        │  + เหตุผล   │            │
│          │      └──────┬──────┘                        └──────┬──────┘            │
│          │             │                                      │                   │
│          │             ▼                                      │                   │
│          │      ┌─────────────┐                               │                   │
│          │      │ ⑤ อนุมัติ    │                               │                   │
│          │      │ Level 2     │  (ถ้าวงเงินสูง)                 │                   │
│          │      └──────┬──────┘                               │                   │
│          │             │                                      │                   │
│          │             ▼                                      │                   │
│          │      ┌─────────────┐                               │                   │
│          │      │ ⑥ คณะกรรมการ │  (ถ้าวงเงินสูงมาก)             │                   │
│          │      └──────┬──────┘                               │                   │
│          │             │                                      │                   │
│          ▼             ▼                                      ▼                   │
│   ┌─────────────────────────────────────────────────────────────────┐            │
│   │                      Push Notification                          │            │
│   └─────────────────────────────────────────────────────────────────┘            │
│          │                                                                         │
│          ▼                                                                         │
│   ┌─────────────┐                                      ┌─────────────┐            │
│   │ ⑦ รับแจ้งผล  │                                      │ ⑧ เบิกจ่าย   │            │
│   │ • อนุมัติ   │  ◀────── หลังโอนเงิน ──────────────  │ • โอนเงิน   │            │
│   │ • ไม่อนุมัติ │                                      │ • พิมพ์สัญญา │            │
│   └─────────────┘                                      └─────────────┘            │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Workflow การค้ำประกัน (Cross-Platform)

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                         GUARANTEE REQUEST WORKFLOW                                  │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   BORROWER APP              GUARANTOR APP                 STAFF APP               │
│   (ผู้กู้)                    (ผู้ค้ำ)                      (พนักงาน)                 │
│                                                                                     │
│   ┌─────────────┐                                                                  │
│   │ ① ยื่นคำขอกู้ │                                                                  │
│   │ เลือกผู้ค้ำ:  │                                                                  │
│   │ • สมศักดิ์   │                                                                  │
│   │ • สมหญิง   │                                                                  │
│   └──────┬──────┘                                                                  │
│          │                                                                          │
│          │  Push Notification                                                      │
│          ▼                                                                          │
│   ┌─────────────────────────────────────────┐                                      │
│   │            ผู้ค้ำทั้ง 2 คนรับแจ้งเตือน       │                                      │
│   └─────────────────────────────────────────┘                                      │
│          │                     │                                                   │
│          ▼                     ▼                                                   │
│   ┌─────────────┐       ┌─────────────┐                                           │
│   │ ② สมศักดิ์   │       │ ③ สมหญิง    │                                           │
│   │ ดูรายละเอียด │       │ ดูรายละเอียด │                                           │
│   │ • ผู้กู้ใคร   │       │ • ผู้กู้ใคร   │                                           │
│   │ • จำนวนเงิน │       │ • จำนวนเงิน │                                           │
│   │ • วงเงินค้ำ  │       │ • วงเงินค้ำ  │                                           │
│   └──────┬──────┘       └──────┬──────┘                                           │
│          │                     │                                                   │
│          ▼                     ▼                                                   │
│   ┌─────────────┐       ┌─────────────┐                                           │
│   │  ✅ ยอมรับ   │       │  ❌ ปฏิเสธ   │                                           │
│   │    ค้ำ      │       │   ค้ำ       │                                           │
│   └──────┬──────┘       └──────┬──────┘                                           │
│          │                     │                                                   │
│          │                     │                                                   │
│          └─────────┬───────────┘                                                   │
│                    │                                                               │
│                    ▼                                                               │
│          ┌─────────────────┐                    ┌─────────────┐                   │
│          │ ④ ตรวจสอบผู้ค้ำ  │ ─────────────────▶ │ ⑤ พิจารณา   │                   │
│          │ • สมศักดิ์ ✅     │                    │ หาผู้ค้ำเพิ่ม │                   │
│          │ • สมหญิง ❌     │                    │ หรือปรับวงเงิน│                   │
│          └─────────────────┘                    └─────────────┘                   │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. Notification System

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                            NOTIFICATION SYSTEM                                      │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                          NOTIFICATION TYPES                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
│   FOR STAFF APP:                           FOR MEMBER APP:                         │
│   ┌────────────────────────┐               ┌────────────────────────┐              │
│   │ 📋 คำขอใหม่รออนุมัติ     │               │ ✅ ผลการอนุมัติ          │              │
│   │ • คำขอกู้ใหม่           │               │ • อนุมัติ/ไม่อนุมัติ      │              │
│   │ • คำขอสวัสดิการ        │               │ • เบิกจ่ายแล้ว          │              │
│   │ • สมัครสมาชิกใหม่      │               │                        │              │
│   │ • ขอถอนหุ้น           │               │ 💰 การเงิน              │              │
│   ├────────────────────────┤               │ • งวดชำระใกล้ถึง       │              │
│   │ ⚠️ แจ้งเตือนสำคัญ       │               │ • รับปันผล             │              │
│   │ • เงินกู้ค้างชำระ       │               │ • ดอกเบี้ยเข้า          │              │
│   │ • เงินฝากครบกำหนด    │               ├────────────────────────┤              │
│   │ • ประชุมคณะกรรมการ   │               │ 🤝 ค้ำประกัน            │              │
│   └────────────────────────┘               │ • มีคนขอให้ค้ำ         │              │
│                                            │ • ผู้กู้ค้างชำระ         │              │
│                                            ├────────────────────────┤              │
│                                            │ 📢 ข่าวสาร              │              │
│                                            │ • ประกาศสหกรณ์        │              │
│                                            │ • โปรโมชั่น            │              │
│                                            └────────────────────────┘              │
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                         NOTIFICATION CHANNELS                               │  │
│   ├─────────────────────────────────────────────────────────────────────────────┤  │
│   │                                                                             │  │
│   │   ┌───────────┐    ┌───────────┐    ┌───────────┐    ┌───────────┐        │  │
│   │   │   Push    │    │   Email   │    │    SMS    │    │   Line    │        │  │
│   │   │Notification│    │           │    │           │    │  Notify   │        │  │
│   │   └───────────┘    └───────────┘    └───────────┘    └───────────┘        │  │
│   │                                                                             │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Data Collections Overview

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           MONGODB COLLECTIONS                                       │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                            CORE COLLECTIONS                                 │  │
│   ├─────────────────────────────────────────────────────────────────────────────┤  │
│   │                                                                             │  │
│   │   ┌────────────────┐                         ┌────────────────┐            │  │
│   │   │     users      │                         │    members     │            │  │
│   │   │ (Authentication)│◀───────────────────────│   (สมาชิก)      │            │  │
│   │   └────────────────┘                         └───────┬────────┘            │  │
│   │                                                      │                      │  │
│   │           ┌──────────────────────────────────────────┼─────────────────┐   │  │
│   │           │                    │                     │                 │   │  │
│   │           ▼                    ▼                     ▼                 ▼   │  │
│   │   ┌──────────────┐   ┌──────────────┐   ┌──────────────┐   ┌──────────────┐│  │
│   │   │    shares    │   │   deposits   │   │    loans     │   │   welfare    ││  │
│   │   │    (หุ้น)     │   │   (เงินฝาก)   │   │   (เงินกู้)   │   │  (สวัสดิการ) ││  │
│   │   └──────────────┘   └──────────────┘   └──────┬───────┘   └──────────────┘│  │
│   │                                                │                           │  │
│   │                                                ▼                           │  │
│   │                                        ┌──────────────┐                    │  │
│   │                                        │  guarantors  │                    │  │
│   │                                        │   (ผู้ค้ำ)    │                    │  │
│   │                                        └──────────────┘                    │  │
│   │                                                                             │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                          SYSTEM COLLECTIONS                                 │  │
│   ├─────────────────────────────────────────────────────────────────────────────┤  │
│   │                                                                             │  │
│   │   ┌────────────────┐   ┌────────────────┐   ┌────────────────┐             │  │
│   │   │  notifications │   │   audit_logs   │   │    settings    │             │  │
│   │   │   (แจ้งเตือน)   │   │  (ประวัติการใช้) │   │    (ตั้งค่า)    │             │  │
│   │   └────────────────┘   └────────────────┘   └────────────────┘             │  │
│   │                                                                             │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. API Endpoints Structure

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              API ENDPOINTS                                          │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   /api/auth                              /api/members                              │
│   ├── POST /google          (Login)      ├── GET    /              (List)          │
│   ├── POST /logout          (Logout)     ├── GET    /:id           (Detail)        │
│   └── GET  /session         (Session)    ├── POST   /              (Create)        │
│                                          ├── PUT    /:id           (Update)        │
│   /api/shares                            ├── POST   /:id/approve   (Approve)       │
│   ├── GET    /              (List)       └── POST   /:id/resign    (Resign)        │
│   ├── POST   /buy           (Buy)                                                  │
│   ├── POST   /withdraw      (Withdraw)   /api/loans                                │
│   └── GET    /balance/:id   (Balance)    ├── GET    /              (List)          │
│                                          ├── POST   /apply         (Apply)         │
│   /api/deposits                          ├── POST   /:id/approve   (Approve)       │
│   ├── GET    /accounts      (Accounts)   ├── POST   /:id/disburse  (Disburse)      │
│   ├── POST   /open          (Open)       ├── POST   /:id/payment   (Payment)       │
│   ├── POST   /deposit       (Deposit)    └── GET    /:id/schedule  (Schedule)      │
│   ├── POST   /withdraw      (Withdraw)                                             │
│   └── GET    /transactions  (History)    /api/welfare                              │
│                                          ├── GET    /types         (Types)         │
│   /api/guarantors                        ├── POST   /claim         (Claim)         │
│   ├── GET    /              (List)       ├── POST   /:id/approve   (Approve)       │
│   ├── GET    /limits/:id    (Limits)     └── GET    /usage/:id     (Usage)         │
│   ├── POST   /accept        (Accept)                                               │
│   └── POST   /reject        (Reject)     /api/notifications                        │
│                                          ├── GET    /              (List)          │
│   /api/reports                           ├── PUT    /:id/read      (Mark Read)     │
│   ├── GET    /daily         (Daily)      └── POST   /send          (Send)          │
│   ├── GET    /monthly       (Monthly)                                              │
│   └── GET    /financial     (Financial)                                            │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. Technology Stack

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                            TECHNOLOGY STACK                                         │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                              FRONTEND                                       │  │
│   ├─────────────────────────────────────────────────────────────────────────────┤  │
│   │                                                                             │  │
│   │   WEB (Admin)              MOBILE (Staff & Member)                         │  │
│   │   ┌────────────────┐       ┌────────────────┐                              │  │
│   │   │   Next.js 14   │       │  React Native  │                              │  │
│   │   │   React 19     │       │      or        │                              │  │
│   │   │   TypeScript   │       │    Flutter     │                              │  │
│   │   │   Tailwind CSS │       │                │                              │  │
│   │   │   shadcn/ui    │       │                │                              │  │
│   │   └────────────────┘       └────────────────┘                              │  │
│   │                                                                             │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                              BACKEND                                        │  │
│   ├─────────────────────────────────────────────────────────────────────────────┤  │
│   │                                                                             │  │
│   │   ┌────────────────┐   ┌────────────────┐   ┌────────────────┐             │  │
│   │   │  Next.js API   │   │   NextAuth.js  │   │   MongoDB      │             │  │
│   │   │  (Route Handler)│   │ (Google OAuth) │   │   (Database)   │             │  │
│   │   └────────────────┘   └────────────────┘   └────────────────┘             │  │
│   │                                                                             │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                             SERVICES                                        │  │
│   ├─────────────────────────────────────────────────────────────────────────────┤  │
│   │                                                                             │  │
│   │   ┌────────────────┐   ┌────────────────┐   ┌────────────────┐             │  │
│   │   │  Google Cloud  │   │    Firebase    │   │  Gemini AI     │             │  │
│   │   │  (Maps, Login) │   │ (Push Notify)  │   │ (OCR, ID Card) │             │  │
│   │   └────────────────┘   └────────────────┘   └────────────────┘             │  │
│   │                                                                             │  │
│   │   ┌────────────────┐   ┌────────────────┐                                  │  │
│   │   │   Cloudinary   │   │   Line Notify  │                                  │  │
│   │   │   (Images)     │   │   (Messages)   │                                  │  │
│   │   └────────────────┘   └────────────────┘                                  │  │
│   │                                                                             │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 10. Security & Access Control

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          SECURITY & ACCESS CONTROL                                  │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                          ROLE-BASED ACCESS                                  │  │
│   ├─────────────────────────────────────────────────────────────────────────────┤  │
│   │                                                                             │  │
│   │   ROLE          PLATFORM         PERMISSIONS                               │  │
│   │   ─────────────────────────────────────────────────────────────────────   │  │
│   │   admin         Web              ทุกสิทธิ์ + จัดการผู้ใช้ + ตั้งค่าระบบ         │  │
│   │   manager       Web, Mobile      อนุมัติทุกวงเงิน + รายงาน                    │  │
│   │   officer       Web, Mobile      อนุมัติตามวงเงิน + ทำรายการ                  │  │
│   │   staff         Web, Mobile      ทำรายการ + ส่งขออนุมัติ                     │  │
│   │   member        Mobile           ดูข้อมูลตัวเอง + ยื่นคำขอ                    │  │
│   │                                                                             │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                       APPROVAL AUTHORITY                                    │  │
│   ├─────────────────────────────────────────────────────────────────────────────┤  │
│   │                                                                             │  │
│   │   วงเงินเงินกู้                LEVEL ที่ต้องอนุมัติ                            │  │
│   │   ────────────────────────────────────────────────────────────────────     │  │
│   │   ≤ 50,000 บาท                Level 1 (Officer)                            │  │
│   │   50,001 - 200,000 บาท        Level 1 + Level 2 (Manager)                  │  │
│   │   > 200,000 บาท               Level 1 + Level 2 + คณะกรรมการ                │  │
│   │                                                                             │  │
│   │   สวัสดิการ                    LEVEL ที่ต้องอนุมัติ                            │  │
│   │   ────────────────────────────────────────────────────────────────────     │  │
│   │   ≤ 10,000 บาท                Level 1 (Officer)                            │  │
│   │   > 10,000 บาท                Level 1 + Level 2 (Manager)                  │  │
│   │                                                                             │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 11. File Structure

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              FILE STRUCTURE                                         │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   src/                                                                             │
│   ├── models/                          # MongoDB Schemas                           │
│   │   ├── member.schema.json                                                       │
│   │   ├── share.schema.json                                                        │
│   │   ├── deposit.schema.json                                                      │
│   │   ├── loan.schema.json                                                         │
│   │   ├── guarantor.schema.json                                                    │
│   │   ├── welfare.schema.json                                                      │
│   │   ├── examples.json                # ข้อมูลตัวอย่างทั้งหมด                       │
│   │   └── DATA_FLOW.md                 # เอกสารนี้                                  │
│   │                                                                                 │
│   ├── app/                             # Next.js App Router                        │
│   │   ├── (auth)/                      # Authentication Pages                      │
│   │   │   └── login/                                                               │
│   │   ├── (admin)/                     # Admin Dashboard                           │
│   │   │   ├── members/                                                             │
│   │   │   ├── shares/                                                              │
│   │   │   ├── deposits/                                                            │
│   │   │   ├── loans/                                                               │
│   │   │   ├── guarantors/                                                          │
│   │   │   ├── welfare/                                                             │
│   │   │   ├── reports/                                                             │
│   │   │   └── settings/                                                            │
│   │   └── api/                         # API Routes                                │
│   │       ├── auth/                                                                │
│   │       ├── members/                                                             │
│   │       ├── shares/                                                              │
│   │       ├── deposits/                                                            │
│   │       ├── loans/                                                               │
│   │       ├── guarantors/                                                          │
│   │       ├── welfare/                                                             │
│   │       └── notifications/                                                       │
│   │                                                                                 │
│   ├── components/                      # React Components                          │
│   ├── lib/                             # Utilities & Helpers                       │
│   └── types/                           # TypeScript Types                          │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 12. Schema Files Reference

| ไฟล์ | Collection | คำอธิบาย |
|------|------------|---------|
| `member.schema.json` | members | ข้อมูลสมาชิก |
| `share.schema.json` | share_* | ระบบหุ้น |
| `deposit.schema.json` | deposit_* | ระบบเงินฝาก |
| `loan.schema.json` | loans, loan_* | ระบบเงินกู้ |
| `guarantor.schema.json` | guarantor_* | ระบบค้ำประกัน |
| `welfare.schema.json` | welfare_* | ระบบสวัสดิการ |
| `examples.json` | - | ข้อมูลตัวอย่างทั้งหมด |
